;define(['jquery','core/theme-app','core/modules/storage','core/theme-tpl-tags','root/config','theme/js/moment.min','theme/js/velocity.min','theme/js/jquery.fitvids'],function($,t,n,s,o,a,A){t.setParam('go-to-default-route-after-refresh',!1);t.setParam('custom-screen-rendering',!0);try{StatusBar.overlaysWebView(!1);StatusBar.styleDefault();StatusBar.backgroundColorByHexString('#F8F8F8')}catch(T){console.log('StatusBar plugin not available - you\'re probably in the browser')};var r=!1,f=$('<div class="spinner"><div class="bar1"></div><div class="bar2"></div><div class="bar3"></div><div class="bar4"></div><div class="bar5"></div><div class="bar6"></div><div class="bar7"></div><div class="bar8"></div><div class="bar9"></div><div class="bar10"></div><div class="bar11"></div><div class="bar12"></div></div>');t.filter('template-args',function(e,t,n){if(t=='single'||t=='page'||t=='archive'){e.getCustomDate=function(e){var s=o.gmt_offset*3600,r=a(),t=a(new Date((e-s)*1000)),i=r.diff(t,'days'),n;if(i==0){n=t.fromNow()}else{n=t.format('MMMM Do YYYY')};return n}};return e});var c='';t.filter('make-history',function(e,t,n,s,o){if(n.screen_type==='single'&&s.screen_type==='single'){if((n.item_id!==o.item_id)){e='push'}else{e='pop'}};c=e;return e});t.filter('transition-direction',function(e,t,n){if(t.screen_type==='single'&&n.screen_type==='single'){if(c==='push'){e='next-screen'}else{e='previous-screen'}};return e});t.filter('transition-direction',function(e,t,n){if(n.screen_type==='single'&&_.isEmpty(t)){e='next-screen'};return e});t.action('screen-transition',function(e,n,s,o,a,r){var i=t.getTransitionDirection(o,a);switch(i){case'next-screen':transition_slide_next_screen(e,n,s,o,a,r);break;case'previous-screen':transition_slide_previous_screen(e,n,s,o,a,r);break;case'default':transition_default(e,n,s,o,a,r);break;default:transition_default(e,n,s,o,a,r);break}});transition_slide_next_screen=function(e,t,s,o,a,r){e.append(s);if(o.screen_type=='list'){n.set('scroll-pos',o.fragment,t.scrollTop())};s.css({left:'100%'});e.velocity({left:'-100%'},{duration:300,easing:'ease-out',complete:function(){t.remove();e.attr('style','');s.css({left:'',});r.resolve()}})};transition_slide_previous_screen=function(e,s,t,a,o,r){e.prepend(t);t.css({left:'-100%'});if(o.screen_type=='list'){var i=n.get('scroll-pos',o.fragment);if(i!==null){t.scrollTop(i)}else{t.scrollTop(0)}};e.velocity({left:'100%'},{duration:300,easing:'ease-out',complete:function(){s.remove();e.attr('style','');t.css({left:'',});r.resolve()}})};transition_default=function(e,t,n,s,o,a){t.remove();e.empty().append(n);a.resolve()};t.on('refresh:start',function(){$('#refresh-button').removeClass('refresh-off').addClass('refresh-on')});t.on('refresh:end',function(s){t.navigateToDefaultRoute();n.clear('scroll-pos');$('#refresh-button').removeClass('refresh-on').addClass('refresh-off');$('#menu-items li').removeClass('menu-active-item');$('#menu-items li:first-child').addClass('menu-active-item');if(s.ok){i('Content updated successfully')}else{i(s.message)}});t.on('info:load-item-from-remote:start',function(){$('#refresh-button').removeClass('refresh-off').addClass('refresh-on')});t.on('info:load-item-from-remote:stop',function(){$('#refresh-button').removeClass('refresh-on').addClass('refresh-off')});t.on('error',function(e){i(e.message)});t.on('screen:showed',function(t,n){if(s.displayBackButton()){$('#back-button').css('display','block');$('#menu-button').css('display','none')}else{$('#back-button').css('display','none');$('#menu-button').css('display','block')};if(r){$('#app-canvas').css('left','85%');l()};if(t.screen_type=='list'){if($('#app-header > h1').html()!=t.label){$('#app-header > h1').html(t.label)}};if(t.screen_type=='single'){if($('#app-header > h1').html()!='Article'){$('#app-header > h1').html('Article')}};if(t.screen_type=='page'){if($('#app-header > h1').html()!=''){$('#app-header > h1').html('')}};if(t.screen_type=='single'||t.screen_type=='page'){$('#app-layout').on('click','.single-content a',B);w();S()}});t.on('screen:leave',function(e,t,n){});t.on('network:online',function(e){var t=s.getNetworkState(!0);i(t)});t.on('network:offline',function(e){var t=s.getNetworkState(!0);i(t)});$('#app-layout').on('touchstart','#menu-button',d);$('#app-layout').on('touchend','#menu-button',m);$('#app-layout').on('touchstart','#refresh-button',g);$('#app-layout').on('touchend','#refresh-button',y);$('#app-layout').on('click','#menu-items li a',v);$('#app-layout').on('click','#content .content-item a',h);$('#app-layout').on('touchstart','#back-button',C);$('#app-layout').on('touchend','#back-button',k);$('#app-layout').on('click touchend','#single-content .content-image-link',function(e){e.preventDefault()});$('#app-layout').on('touchend','#get-more-button',D);window.displayDefaultImage=function(t){$(t).attr('src',s.getThemeAssetUrl('img/img-icon.svg'))};function u(){$('#menu-items').css('display','block');$('#app-canvas').velocity({left:'85%',},{duration:300,complete:function(){setTimeout(function(){r=!0},150)}})};function l(n,s){r=!1;$('#app-canvas').velocity({left:'0',},300,function(){$('#menu-items').css('display','none');if(n==1){t.navigate(s.attr('href'))}})};function p(){if(r){l()}else{u()}};function d(t){t.preventDefault();$('#menu-button').removeClass('button-tap-off').addClass('button-tap-on')};function m(t){t.preventDefault();$('#menu-button').removeClass('button-tap-on').addClass('button-tap-off');p()};function v(t){t.preventDefault();if(r){$('#menu-items li').removeClass('menu-active-item');$(this).closest('li').addClass('menu-active-item');l(1,$(this))}};function h(n){n.preventDefault();if(!r){t.navigate($(this).attr('href'))}else{l()}};function i(t){$('#app-message-bar').html(t);$('#app-message-bar').removeClass('message-off').addClass('message-on');setTimeout(b,3000)};function b(){$('#app-message-bar').removeClass('message-on').addClass('message-off');$('#app-message-bar').html('')};function g(t){t.preventDefault();$('#refresh-button').removeClass('button-touch-off').addClass('button-touch-on')};function y(n){n.preventDefault();if(!t.isRefreshing()){$('#refresh-button').removeClass('button-touch-on').addClass('button-touch-off');$('#refresh-button').removeClass('refresh-off').addClass('refresh-on');t.refresh()}};function x(){$('#refresh-button').removeClass('refresh-on').addClass('refresh-off')};function C(t){t.preventDefault();$('#back-button').removeClass('button-tap-off').addClass('button-tap-on')};function k(n){n.preventDefault();$('#back-button').removeClass('button-tap-on').addClass('button-tap-off');t.navigate(s.getPreviousScreenLink())};function D(n){n.preventDefault();$('#get-more-button').attr('disabled','disabled');$('#get-more-button').append(f);t.getMoreComponentItems(function(){$('#get-more-button .spinner').remove();$('#get-more-button').removeAttr('disabled')},function(t,n){$('#get-more-button .spinner').remove();$('#get-more-button').removeAttr('disabled')})};function w(){$('.single-template blockquote.twitter-tweet p').css('display','inline-block');$('.wpak-content-not-available').html('Content unavailable')};function B(n){n.preventDefault();var o=$(n.target),s=o.attr('href');if(s.charAt(0)!=='#'){try{cordova.InAppBrowser.open(s,'_blank','location=yes')}catch(a){window.open(s,'_blank','location=yes')}}else{if(!o.hasClass('q-theme-prevent-navigation')){t.navigate(s)}}};function S(){$('iframe').each(function(t){if($(this).attr('data-src')){$(this).attr('src',$(this).attr('data-src'))}});$('#single-content').fitVids()}});